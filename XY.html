<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EurekaAI - Advanced AI Platform</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://js.puter.com/v2/"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/5.1.1/marked.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#5D5CDE',
                        secondary: '#4F46E5',
                        accent: '#EC4899',
                        dark: '#181818'
                    },
                    fontFamily: {
                        'arabic': ['Cairo', 'Segoe UI', 'Tahoma', 'Geneva', 'Verdana', 'sans-serif'],
                        'english': ['Inter', 'system-ui', 'sans-serif'],
                        'portuguese': ['Inter', 'system-ui', 'sans-serif']
                    },
                    animation: {
                        'fade-in-up': 'fadeInUp 0.6s ease-out',
                        'fade-in-left': 'fadeInLeft 0.6s ease-out',
                        'fade-in-right': 'fadeInRight 0.6s ease-out',
                        'float': 'float 3s ease-in-out infinite',
                        'pulse-slow': 'pulse 3s ease-in-out infinite',
                        'gradient': 'gradient 8s ease infinite',
                        'typing': 'typing 1s ease-in-out infinite',
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;900&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;900&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
        }
        
        [dir="rtl"] body {
            font-family: 'Cairo', sans-serif;
        }
        
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes fadeInLeft {
            from { opacity: 0; transform: translateX(-30px); }
            to { opacity: 1; transform: translateX(0); }
        }
        
        @keyframes fadeInRight {
            from { opacity: 0; transform: translateX(30px); }
            to { opacity: 1; transform: translateX(0); }
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }
        
        @keyframes gradient {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }
        
        @keyframes typing {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }
        
        .gradient-bg {
            background: linear-gradient(-45deg, #5D5CDE, #4F46E5, #EC4899, #8B5CF6);
            background-size: 400% 400%;
            animation: gradient 8s ease infinite;
        }
        
        .glass-effect {
            backdrop-filter: blur(20px);
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .dark .glass-effect {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .glow {
            box-shadow: 0 0 20px rgba(93, 92, 222, 0.3);
        }
        
        .dark .glow {
            box-shadow: 0 0 30px rgba(93, 92, 222, 0.5);
        }
        
        .text-gradient {
            background: linear-gradient(135deg, #5D5CDE, #EC4899);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .chat-container {
            height: calc(100vh - 120px);
        }
        
        .message-bubble {
            max-width: 70%;
            word-wrap: break-word;
        }
        
        .typing-indicator {
            display: inline-block;
        }
        
        .typing-indicator span {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: #5D5CDE;
            margin: 0 2px;
            animation: typing 1.4s ease-in-out infinite;
        }
        
        .typing-indicator span:nth-child(2) {
            animation-delay: 0.2s;
        }
        
        .typing-indicator span:nth-child(3) {
            animation-delay: 0.4s;
        }
        
        .scrollbar-hide {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }
        
        .model-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        
        .model-card.selected {
            border-color: #5D5CDE;
            box-shadow: 0 0 0 3px rgba(93, 92, 222, 0.1);
        }
        
        /* Language Selector Styles */
        .language-selector {
            position: relative;
        }
        
        .language-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            z-index: 50;
            min-width: 150px;
        }
        
        .dark .language-dropdown {
            background: #374151;
            border-color: #4b5563;
        }
        
        [dir="rtl"] .language-dropdown {
            right: auto;
            left: 0;
        }
        
        .language-option {
            padding: 0.5rem 1rem;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .language-option:hover {
            background-color: #f3f4f6;
        }
        
        .dark .language-option:hover {
            background-color: #4b5563;
        }
        
        .language-option.active {
            background-color: #5D5CDE;
            color: white;
        }
        
        /* RTL Support */
        [dir="rtl"] .space-x-4 > * + * {
            margin-left: 0;
            margin-right: 1rem;
        }
        
        [dir="rtl"] .space-x-reverse > * + * {
            margin-left: 1rem;
            margin-right: 0;
        }
        
        [dir="rtl"] .mr-2 {
            margin-right: 0;
            margin-left: 0.5rem;
        }
        
        [dir="rtl"] .ml-2 {
            margin-left: 0;
            margin-right: 0.5rem;
        }
        
        [dir="rtl"] .pr-12 {
            padding-right: 0;
            padding-left: 3rem;
        }
        
        [dir="rtl"] .right-4 {
            right: auto;
            left: 1rem;
        }
    </style>
</head>
<body class="bg-white dark:bg-dark transition-colors duration-300">
    <!-- Navigation -->
    <nav class="fixed top-0 w-full z-50 glass-effect">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center space-x-4">
                    <div class="text-2xl font-bold text-gradient cursor-pointer" onclick="showModelSelection()">
                        <i class="fas fa-brain mr-2"></i>
                        EurekaAI
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div id="currentModelName" class="hidden text-sm font-medium text-gray-600 dark:text-gray-300"></div>
                    <button id="newChatBtn" class="hidden bg-primary text-white px-4 py-2 rounded-lg hover:bg-secondary transition-all duration-300" onclick="newChat()">
                        <i class="fas fa-plus mr-2"></i>
                        <span data-translate="chat.new_chat">New Chat</span>
                    </button>
                    <button id="backBtn" class="hidden text-gray-600 dark:text-gray-300 hover:text-primary transition-colors" onclick="showModelSelection()">
                        <i class="fas fa-arrow-left text-xl"></i>
                    </button>
                    
                    <!-- Language Selector -->
                    <div class="language-selector">
                        <button id="languageSelector" class="flex items-center space-x-2 text-gray-700 dark:text-gray-300 hover:text-primary transition-colors">
                            <i class="fas fa-globe"></i>
                            <span class="current-lang" data-translate="lang.english">English</span>
                            <i class="fas fa-chevron-down text-xs"></i>
                        </button>
                        <div id="languageDropdown" class="language-dropdown hidden">
                            <div class="language-option" data-lang="en">
                                <span data-translate="lang.english">English</span>
                            </div>
                            <div class="language-option" data-lang="pt">
                                <span data-translate="lang.portuguese">Português (BR)</span>
                            </div>
                            <div class="language-option" data-lang="ar">
                                <span data-translate="lang.arabic">العربية</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Model Selection Screen -->
    <div id="modelSelection" class="pt-16 min-h-screen bg-gray-50 dark:bg-gray-900">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <div class="text-center mb-12 animate-fade-in-up">
                <h1 class="text-4xl md:text-5xl font-bold text-gray-900 dark:text-white mb-4">
                    <span data-translate="chat.select_model">Choose AI Model</span>
                </h1>
                <p class="text-xl text-gray-600 dark:text-gray-300 max-w-2xl mx-auto" data-translate="chat.model_subtitle">
                    A diverse range of advanced AI models to meet all your needs
                </p>
            </div>

            <!-- Search and Filter -->
            <div class="mb-8">
                <div class="flex flex-col sm:flex-row gap-4 justify-center items-center">
                    <div class="relative w-full sm:w-96">
                        <input type="text" id="searchInput" data-translate="chat.search_placeholder" placeholder="Search for a model..." 
                               class="w-full px-4 py-3 pr-12 text-base bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-xl focus:ring-2 focus:ring-primary focus:border-transparent">
                        <i class="fas fa-search absolute right-4 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                    </div>
                    <div class="flex gap-2">
                        <button class="filter-btn active px-4 py-3 bg-primary text-white rounded-xl" data-category="all" data-translate="chat.filter_all">All</button>
                        <button class="filter-btn px-4 py-3 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-xl" data-category="chat" data-translate="chat.filter_chat">Chat</button>
                        <button class="filter-btn px-4 py-3 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-xl" data-category="image" data-translate="chat.filter_image">Images</button>
                        <button class="filter-btn px-4 py-3 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-xl" data-category="voice" data-translate="chat.filter_voice">Voice</button>
                    </div>
                </div>
            </div>

            <!-- AI Models Grid -->
            <div id="modelsGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                <!-- Chat Models -->
                <div class="model-card bg-white dark:bg-gray-800 p-6 rounded-2xl shadow-lg cursor-pointer transition-all duration-300" 
                     data-category="chat" data-model="o3-mini" onclick="selectModel(this, 'OpenAI o3-mini', 'chat')">
                    <div class="w-16 h-16 bg-gradient-to-br from-blue-500 to-black-500 rounded-xl flex items-center justify-center mb-4 overflow-hidden">
                         <img src="img/open-ai-square.svg" alt="OpenAI Icon" class="w-20 h-20 object-contain">
                      </div>
                    <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-2">OpenAI o3-mini</h3>
                    <p class="text-gray-600 dark:text-gray-300 text-sm mb-3" data-translate="model.openai_o3_mini">Latest model from OpenAI for advanced AI</p>
                    <div class="flex items-center justify-between">
                        <span class="text-xs bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200 px-2 py-1 rounded-full" data-translate="chat.free">Free</span>
                        <span class="text-xs text-gray-500" data-translate="chat.filter_chat">Chat</span>
                    </div>
                </div>

                <div class="model-card bg-white dark:bg-gray-800 p-6 rounded-2xl shadow-lg cursor-pointer transition-all duration-300" 
                     data-category="chat" data-model="gpt-4o-mini" onclick="selectModel(this, 'GPT-4o Mini', 'chat')">
                    <div class="w-16 h-16 bg-gradient-to-br from-blue-500 to-purple-500 rounded-xl flex items-center justify-center mb-4 overflow-hidden">
                         <img src="img/openai-blue-logo.webp" alt="GPT Icon" class="w-20 h-20 object-contain">
                      </div>
                    <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-2">GPT-4o Mini</h3>
                    <p class="text-gray-600 dark:text-gray-300 text-sm mb-3" data-translate="model.gpt4o_mini">Enhanced and fast version of GPT-4</p>
                    <div class="flex items-center justify-between">
                        <span class="text-xs bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200 px-2 py-1 rounded-full" data-translate="chat.free">Free</span>
                        <span class="text-xs text-gray-500" data-translate="chat.filter_chat">Chat</span>
                    </div>
                </div>

                <div class="model-card bg-white dark:bg-gray-800 p-6 rounded-2xl shadow-lg cursor-pointer transition-all duration-300" 
                     data-category="chat" data-model="grok-beta" onclick="selectModel(this, 'grok-beta', 'chat')">
                    <div class="w-16 h-16 bg-gradient-to-br from-blue-500 to-purple-500 rounded-xl flex items-center justify-center mb-4 overflow-hidden">
                         <img src="img/Vgg2hEPa_400x400.jpg" alt="Grok Icon" class="w-20 h-20 object-contain">
                      </div>
                    <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-2">Grok beta</h3>
                    <p class="text-gray-600 dark:text-gray-300 text-sm mb-3" data-translate="model.grok_beta">Enhanced and fast version of Grok</p>
                    <div class="flex items-center justify-between">
                        <span class="text-xs bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200 px-2 py-1 rounded-full" data-translate="chat.free">Free</span>
                        <span class="text-xs text-gray-500" data-translate="chat.filter_chat">Chat</span>
                    </div>
                </div>

                <div class="model-card bg-white dark:bg-gray-800 p-6 rounded-2xl shadow-lg cursor-pointer transition-all duration-300" 
                     data-category="chat" data-model="gemini-2.0-flash" onclick="selectModel(this, 'gemini-2.0-flash', 'chat')">
                    <div class="w-16 h-16 bg-gradient-to-br from-blue-500 to-purple-500 rounded-xl flex items-center justify-center mb-4 overflow-hidden">
                         <img src="img/generate-ai-abstract-vector-symbol-artificial-intelligence-colorful-stars-icon_34480-1539.jpg" alt="Gemini Icon" class="w-20 h-20 object-contain">
                      </div>
                    <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-2">Gemini 2.0 Flash</h3>
                    <p class="text-gray-600 dark:text-gray-300 text-sm mb-3" data-translate="model.gemini_2_flash">Enhanced and fast version of Gemini</p>
                    <div class="flex items-center justify-between">
                        <span class="text-xs bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200 px-2 py-1 rounded-full" data-translate="chat.free">Free</span>
                        <span class="text-xs text-gray-500" data-translate="chat.filter_chat">Chat</span>
                    </div>
                </div>

                <div class="model-card bg-white dark:bg-gray-800 p-6 rounded-2xl shadow-lg cursor-pointer transition-all duration-300" 
                     data-category="chat" data-model="gemini-1.5-flash" onclick="selectModel(this, 'gemini-1.5-flash', 'chat')">
                    <div class="w-16 h-16 bg-gradient-to-br from-blue-0 to-purple-0 rounded-xl flex items-center justify-center mb-4 overflow-hidden">
                         <img src="img/gemini-google-icon-symbol-logo-free-png.webp" alt="Gemini Icon" class="w-20 h-20 object-contain">
                      </div>
                    <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-2">Gemini 1.5 Flash</h3>
                    <p class="text-gray-600 dark:text-gray-300 text-sm mb-3" data-translate="model.gemini_1_5_flash">Enhanced and fast version of Gemini</p>
                    <div class="flex items-center justify-between">
                        <span class="text-xs bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200 px-2 py-1 rounded-full" data-translate="chat.free">Free</span>
                        <span class="text-xs text-gray-500" data-translate="chat.filter_chat">Chat</span>
                    </div>
                </div>

                <div class="model-card bg-white dark:bg-gray-800 p-6 rounded-2xl shadow-lg cursor-pointer transition-all duration-300" data-category="chat" data-model="claude-sonnet-4" onclick="selectModel(this, 'claude-sonnet-4', 'chat')">
                    <div class="w-16 h-16 bg-gradient-to-br from-blue-0 to-purple-0 rounded-xl flex items-center justify-center mb-4 overflow-hidden">
                         <img src="img/peueeehosysccnmwsszx-removebg-preview.png" alt="Claude Icon" class="w-15 h-15 object-contain">
                      </div>
                 <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-2">Claude Sonnet 4</h3>
                 <p class="text-gray-600 dark:text-gray-300 text-sm mb-3" data-translate="model.claude_sonnet">Enhanced version of Claude</p>
                 <div class="flex items-center justify-between">
                          <span class="text-xs bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200 px-2 py-1 rounded-full" data-translate="chat.free">Free</span>
                          <span class="text-xs text-gray-500" data-translate="chat.filter_chat">Chat</span>
                     </div>
                </div>

                <div class="model-card bg-white dark:bg-gray-800 p-6 rounded-2xl shadow-lg cursor-pointer transition-all duration-300" 
                     data-category="chat" data-model="deepseek-chat" onclick="selectModel(this, 'DeepSeek Chat', 'chat')">
                    <div class="w-16 h-16 bg-gradient-to-br from-blue-0 to-purple-0 rounded-xl flex items-center justify-center mb-4 overflow-hidden">
                         <img src="img/deepseek-color.png" alt="DeepSeek Icon" class="w-15 h-15 object-contain">
                      </div>
                    <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-2">DeepSeek Chat-V3</h3>
                    <p class="text-gray-600 dark:text-gray-300 text-sm mb-3" data-translate="model.deepseek_chat">DeepSeek Chat: Advanced model for intelligent conversation</p>
                    <div class="flex items-center justify-between">
                        <span class="text-xs bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200 px-2 py-1 rounded-full" data-translate="chat.free">Free</span>
                        <span class="text-xs text-gray-500" data-translate="chat.filter_chat">Chat</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Chat Interface -->
    <div id="chatInterface" class="hidden pt-16 min-h-screen bg-gray-50 dark:bg-gray-900">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-full">
            <!-- Chat Header -->
            <div class="bg-white dark:bg-gray-800 rounded-t-2xl p-6 border-b border-gray-200 dark:border-gray-700">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-4">
                        <div class="w-12 h-12 bg-primary rounded-xl flex items-center justify-center">
                            <i class="fas fa-robot text-white text-xl"></i>
                        </div>
                        <div>
                            <h2 id="chatModelName" class="text-xl font-bold text-gray-900 dark:text-white">AI Model</h2>
                            <p id="modelDescription" class="text-sm text-gray-600 dark:text-gray-400" data-translate="chat.available_for_chat">Available for chat and general questions</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-2">
                        <button onclick="exportChat()" class="text-gray-600 dark:text-gray-300 hover:text-primary transition-colors" title="Export Chat">
                            <i class="fas fa-download"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Chat Messages -->
            <div class="bg-white dark:bg-gray-800 chat-container overflow-y-auto scrollbar-hide">
                <div id="chatMessages" class="p-6 space-y-4">
                    <div class="max-w-4xl mx-auto">
                        <div class="text-center py-8">
                            <div class="w-20 h-20 bg-gradient-to-br from-primary to-accent rounded-full flex items-center justify-center mx-auto mb-4 animate-pulse-slow">
                                <i class="fas fa-robot text-2xl text-white"></i>
                            </div>
                            <h3 class="text-xl font-semibold text-gray-900 dark:text-white mb-2" data-translate="chat.welcome">Hello! How can I help you?</h3>
                            <p class="text-gray-600 dark:text-gray-400">
                                <span data-translate="chat.start_conversation">Start your conversation with</span> <span id="welcomeModelName">AI</span>
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Chat Input -->
            <div class="bg-white dark:bg-gray-800 rounded-b-2xl p-6 border-t border-gray-200 dark:border-gray-700">
                <!-- File Attachment Display -->
                <div id="attachedFile" class="hidden mb-4 p-3 bg-gray-100 dark:bg-gray-700 rounded-lg flex items-center justify-between">
                    <div class="flex items-center space-x-2">
                        <i class="fas fa-paperclip text-gray-500"></i>
                        <span id="fileName" class="text-sm text-gray-700 dark:text-gray-300"></span>
                    </div>
                    <button onclick="removeAttachment()" class="text-red-500 hover:text-red-700">
                        <i class="fas fa-times"></i>
                    </button>
                </div>

                <div class="flex items-end space-x-4">
                    <div class="flex-1 relative">
                        <textarea 
                            id="messageInput" 
                            data-translate="chat.type_message"
                            placeholder="Type your message..."
                            class="w-full px-4 py-3 pr-12 bg-gray-100 dark:bg-gray-700 border-0 rounded-xl resize-none focus:ring-2 focus:ring-primary focus:outline-none text-gray-900 dark:text-white"
                            rows="1"
                            style="min-height: 48px; max-height: 120px;"
                        ></textarea>
                        <button id="attachBtn" class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-primary transition-colors">
                            <i class="fas fa-paperclip"></i>
                        </button>
                        <input type="file" id="fileInput" class="hidden" accept="image/*,audio/*,video/*,.pdf,.doc,.docx,.txt">
                    </div>
                    <button 
                        id="sendBtn"
                        onclick="sendMessage()" 
                        class="bg-primary text-white px-6 py-3 rounded-xl hover:bg-secondary transition-all duration-300 flex items-center space-x-2"
                    >
                        <span data-translate="chat.send">Send</span>
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Load translation system -->
    <script src="translations.js"></script>

    <script>
        // Global variables
        let currentModel = null;
        let currentModelType = null;
        let currentModelName = '';
        let chatHistory = [];
        let attachedFile = null;

        // Dark mode detection
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });

        // Initialize application
        async function initApp() {
            try {
                // Setup event listeners
                setupEventListeners();
                
                // Setup search and filter functionality
                setupSearchAndFilter();
                
                // Setup language selector
                setupLanguageSelector();
                
                console.log('EurekaAI initialized successfully');
            } catch (error) {
                console.error('Failed to initialize:', error);
                showError('Failed to initialize the application. Please reload the page.');
            }
        }

        // Setup language selector functionality
        function setupLanguageSelector() {
            const languageSelector = document.getElementById('languageSelector');
            const languageDropdown = document.getElementById('languageDropdown');
            
            // Language selector
            languageSelector.addEventListener('click', function(e) {
                e.stopPropagation();
                languageDropdown.classList.toggle('hidden');
            });
            
            // Language option selection
            document.querySelectorAll('.language-option').forEach(option => {
                option.addEventListener('click', function() {
                    const lang = this.dataset.lang;
                    langManager.setLanguage(lang);
                    languageDropdown.classList.add('hidden');
                    
                    // Update active state
                    document.querySelectorAll('.language-option').forEach(opt => {
                        opt.classList.remove('active');
                    });
                    document.querySelectorAll(`[data-lang="${lang}"]`).forEach(opt => {
                        opt.classList.add('active');
                    });
                    
                    // Update welcome message model name
                    updateWelcomeModelName();
                });
            });
            
            // Close dropdown when clicking outside
            document.addEventListener('click', function() {
                languageDropdown.classList.add('hidden');
            });
            
            // Set initial active state
            const currentLang = langManager.currentLanguage;
            document.querySelectorAll(`[data-lang="${currentLang}"]`).forEach(opt => {
                opt.classList.add('active');
            });
        }

        // Setup event listeners
        function setupEventListeners() {
            // Message input auto-resize
            const messageInput = document.getElementById('messageInput');
            messageInput.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = Math.min(this.scrollHeight, 120) + 'px';
            });

            // Send message on Enter (Shift+Enter for new line)
            messageInput.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });

            // File attachment
            document.getElementById('attachBtn').addEventListener('click', () => {
                document.getElementById('fileInput').click();
            });

            document.getElementById('fileInput').addEventListener('change', handleFileAttachment);
        }

        // Setup search and filter functionality
        function setupSearchAndFilter() {
            const searchInput = document.getElementById('searchInput');
            const filterBtns = document.querySelectorAll('.filter-btn');
            const modelCards = document.querySelectorAll('.model-card');

            // Search functionality
            searchInput.addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase();
                filterModels(searchTerm, getCurrentFilter());
            });

            // Filter functionality
            filterBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    // Update active filter button
                    filterBtns.forEach(b => {
                        b.classList.remove('active', 'bg-primary', 'text-white');
                        b.classList.add('bg-gray-200', 'dark:bg-gray-700', 'text-gray-700', 'dark:text-gray-300');
                    });
                    
                    this.classList.add('active', 'bg-primary', 'text-white');
                    this.classList.remove('bg-gray-200', 'dark:bg-gray-700', 'text-gray-700', 'dark:text-gray-300');

                    // Apply filter
                    const category = this.dataset.category;
                    const searchTerm = searchInput.value.toLowerCase();
                    filterModels(searchTerm, category);
                });
            });
        }

        // Get current filter
        function getCurrentFilter() {
            const activeBtn = document.querySelector('.filter-btn.active');
            return activeBtn ? activeBtn.dataset.category : 'all';
        }

        // Filter models
        function filterModels(searchTerm, category) {
            const modelCards = document.querySelectorAll('.model-card');
            
            modelCards.forEach(card => {
                const modelName = card.querySelector('h3').textContent.toLowerCase();
                const modelDescription = card.querySelector('p').textContent.toLowerCase();
                const modelCategory = card.dataset.category;
                
                const matchesSearch = modelName.includes(searchTerm) || modelDescription.includes(searchTerm);
                const matchesCategory = category === 'all' || modelCategory === category;
                
                if (matchesSearch && matchesCategory) {
                    card.style.display = 'block';
                    card.classList.add('animate-fade-in-up');
                } else {
                    card.style.display = 'none';
                }
            });
        }

        // Select model
        function selectModel(element, modelName, modelType) {
            // Remove previous selection
            document.querySelectorAll('.model-card').forEach(card => {
                card.classList.remove('selected');
            });

            // Add selection to current card
            element.classList.add('selected');

            // Set current model
            currentModel = element.dataset.model;
            currentModelType = modelType;
            currentModelName = modelName;

            console.log('Selected model:', currentModel);

            // Update UI
            setTimeout(() => {
                showChatInterface();
            }, 300);
        }

        // Show chat interface
        function showChatInterface() {
            document.getElementById('modelSelection').classList.add('hidden');
            document.getElementById('chatInterface').classList.remove('hidden');
            
            // Update header
            document.getElementById('currentModelName').textContent = currentModelName;
            document.getElementById('currentModelName').classList.remove('hidden');
            document.getElementById('newChatBtn').classList.remove('hidden');
            document.getElementById('backBtn').classList.remove('hidden');
            
            // Update chat header
            document.getElementById('chatModelName').textContent = currentModelName;
            document.getElementById('modelDescription').textContent = getModelDescription(currentModelType);
            
            // Update welcome message
            updateWelcomeModelName();
            
            // Clear previous chat
            clearChat();
            
            // Focus on input
            document.getElementById('messageInput').focus();
        }

        // Update welcome model name
        function updateWelcomeModelName() {
            const welcomeModelName = document.getElementById('welcomeModelName');
            if (welcomeModelName && currentModelName) {
                welcomeModelName.textContent = currentModelName;
            }
        }

        // Show model selection
        function showModelSelection() {
            document.getElementById('chatInterface').classList.add('hidden');
            document.getElementById('modelSelection').classList.remove('hidden');
            
            // Update header
            document.getElementById('currentModelName').classList.add('hidden');
            document.getElementById('newChatBtn').classList.add('hidden');
            document.getElementById('backBtn').classList.add('hidden');
            
            // Clear model selection
            currentModel = null;
            currentModelType = null;
            currentModelName = '';
        }

        // Get model description
        function getModelDescription(modelType) {
            const descriptions = {
                'chat': langManager.translate('chat.available_for_chat'),
                'image': langManager.translate('chat.available_for_images'),
                'voice': langManager.translate('chat.available_for_voice'),
                'vision': langManager.translate('chat.available_for_vision')
            };
            return descriptions[modelType] || langManager.translate('chat.available');
        }

        // Send message
        async function sendMessage() {
            const messageInput = document.getElementById('messageInput');
            const userMessage = messageInput.value.trim();
            
            if (!userMessage && !attachedFile) return;
            
            // Disable send button
            const sendBtn = document.getElementById('sendBtn');
            sendBtn.disabled = true;
            
            try {
                // Add user message to chat
                addMessage(userMessage, 'user');
                
                // Clear input
                messageInput.value = '';
                messageInput.style.height = 'auto';
                
                // Clear attachment
                removeAttachment();
                
                // Send to AI
                const chat_resp = await puter.ai.chat(userMessage, { 
                    model: currentModel, 
                    stream: true 
                });
                
                let botMsg = '';
                addMessage('...', 'bot');
                
                for await (const part of chat_resp) {
                    if (part?.text) {
                        botMsg += part.text;
                        // Update the last bot message
                        const chatMessages = document.getElementById('chatMessages');
                        const lastBotMessage = chatMessages.querySelector('.bot-message:last-child .message-content');
                        if (lastBotMessage) {
                            lastBotMessage.innerHTML = formatMessage(botMsg);
                            chatMessages.scrollTop = chatMessages.scrollHeight;
                        }
                    }
                }
                
            } catch (error) {
                console.error('Error sending message:', error);
                addMessage('Sorry, there was an error connecting to the AI. Please try again.', 'bot');
            } finally {
                sendBtn.disabled = false;
            }
        }

        // Add message to chat
        function addMessage(text, sender) {
            const chatMessages = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `flex mb-4 ${sender === 'user' ? 'justify-end' : 'justify-start'} ${sender === 'bot' ? 'bot-message' : ''}`;
            
            const isUser = sender === 'user';
            const bubbleClass = isUser 
                ? 'bg-primary text-white' 
                : 'bg-white dark:bg-gray-800 text-gray-900 dark:text-white border border-gray-200 dark:border-gray-700';
            
            const currentTime = new Date().toLocaleTimeString(langManager.currentLanguage === 'ar' ? 'ar-SA' : 'en-US', { 
                hour: '2-digit', 
                minute: '2-digit' 
            });
            
            messageDiv.innerHTML = `
                <div class="message-bubble ${bubbleClass} px-4 py-3 rounded-2xl shadow-sm max-w-[70%]">
                    ${!isUser ? '<div class="flex items-center mb-2"><div class="w-6 h-6 bg-primary rounded-full flex items-center justify-center mr-2"><i class="fas fa-robot text-xs text-white"></i></div><span class="text-sm font-medium">' + currentModelName + '</span></div>' : ''}
                    <div class="message-content">${formatMessage(text)}</div>
                    <div class="text-xs ${isUser ? 'text-blue-100' : 'text-gray-500 dark:text-gray-400'} mt-1">
                        ${currentTime}
                    </div>
                </div>
            `;
            
            chatMessages.appendChild(messageDiv);
            
            // Add to history
            chatHistory.push({
                sender,
                message: text,
                timestamp: new Date()
            });
            
            // Scroll to bottom
            chatMessages.scrollTop = chatMessages.scrollHeight;
            
            // Add animation
            messageDiv.classList.add('animate-fade-in-up');
        }

        // Format message (support markdown)
        function formatMessage(message) {
            if (typeof marked !== 'undefined') {
                return marked.parse(message);
            }
            return message.replace(/\n/g, '<br>');
        }

        // Handle file attachment
        function handleFileAttachment(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            // Check file size (max 10MB)
            if (file.size > 10 * 1024 * 1024) {
                showError('File size is too large. Maximum 10MB allowed.');
                return;
            }
            
            attachedFile = file;
            
            // Show attached file
            document.getElementById('attachedFile').classList.remove('hidden');
            document.getElementById('fileName').textContent = file.name;
        }

        // Remove attachment
        function removeAttachment() {
            attachedFile = null;
            document.getElementById('attachedFile').classList.add('hidden');
            document.getElementById('fileInput').value = '';
        }

        // Clear chat
        function clearChat() {
            const welcomeMessage = `
                <div class="max-w-4xl mx-auto">
                    <div class="text-center py-8">
                        <div class="w-20 h-20 bg-gradient-to-br from-primary to-accent rounded-full flex items-center justify-center mx-auto mb-4 animate-pulse-slow">
                            <i class="fas fa-robot text-2xl text-white"></i>
                        </div>
                        <h3 class="text-xl font-semibold text-gray-900 dark:text-white mb-2">${langManager.translate('chat.welcome')}</h3>
                        <p class="text-gray-600 dark:text-gray-400">
                            ${langManager.translate('chat.start_conversation')} ${currentModelName}
                        </p>
                    </div>
                </div>
            `;
            
            document.getElementById('chatMessages').innerHTML = welcomeMessage;
            chatHistory = [];
        }

        // New chat
        function newChat() {
            clearChat();
            removeAttachment();
            document.getElementById('messageInput').focus();
        }

        // Export chat
        function exportChat() {
            if (chatHistory.length === 0) {
                showError('No conversation to export.');
                return;
            }
            
            const chatText = chatHistory.map(msg => {
                const time = msg.timestamp.toLocaleString(langManager.currentLanguage === 'ar' ? 'ar-SA' : 'en-US');
                const sender = msg.sender === 'user' ? 'You' : currentModelName;
                return `[${time}] ${sender}: ${msg.message}`;
            }).join('\n\n');
            
            const blob = new Blob([chatText], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `EurekaAI_Chat_${new Date().toISOString().split('T')[0]}.txt`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // Show error
        function showError(message) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-sm w-full mx-4">
                    <div class="flex items-center mb-4">
                        <i class="fas fa-exclamation-triangle text-red-500 text-2xl mr-3"></i>
                        <h3 class="text-lg font-semibold text-gray-900 dark:text-white">Alert</h3>
                    </div>
                    <p class="text-gray-700 dark:text-gray-300 mb-4">${message}</p>
                    <div class="flex justify-end">
                        <button class="px-4 py-2 bg-primary text-white hover:bg-secondary rounded-lg transition-colors" onclick="this.closest('.fixed').remove()">
                            OK
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            
            // Auto remove after 5 seconds
            setTimeout(() => {
                if (modal.parentNode) {
                    modal.remove();
                }
            }, 5000);
        }

        // Initialize app when page loads
        window.addEventListener('load', function() {
            initApp();
            
            // Trigger initial translation update
            setTimeout(() => {
                langManager.updatePageContent();
                updateWelcomeModelName();
            }, 100);
        });
    </script>
</body>
</html>

